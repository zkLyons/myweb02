import{B as C,d as ee,r as m,c as le,C as te,e as d,o as ae,f as oe,g as l,w as t,h as r,z as _,k as c,i as E,F as ne,v as O,D as S,_ as re}from"./index-8f68718e.js";import{u as se}from"./setting-7f6def1b.js";const ie=(s,y,u)=>C.get(`/admin/acl/role/${s}/${y}/?roleName=${u}`),de=s=>s.id?C.put("/admin/acl/role/update",s):C.post("/admin/acl/role/save",s),ue=s=>C.get("/admin/acl/permission/toAssign/"+s),pe=(s,y)=>C.post(`/admin/acl/permission/doAssign/?roleId=${s}&permissionId=${y}`),me=s=>C.delete("/admin/acl/role/remove/"+s),fe={style:{flex:"auto"}},ce=ee({__name:"index",setup(s){let y=se(),u=m(1),x=m(10),g=m(""),z=m([]),U=m(0),f=m(!1),V=m(),v=m(!1),i=le({roleName:""}),q=m([]),N=m([]),R=m();te(()=>{b()});const b=async(o=1)=>{u.value=o;let e=await ie(u.value,x.value,g.value);e.code==200&&(U.value=e.data.total,z.value=e.data.records)},j=()=>{b()},T=()=>{b(),g.value=""},B=()=>{y.refsh=!y.refsh},D=()=>{f.value=!0,Object.assign(i,{roleName:"",id:0}),O(()=>{V.value.clearValidate("roleName")})},L=o=>{f.value=!0,Object.assign(i,o),O(()=>{V.value.clearValidate("roleName")})},M={roleName:[{required:!0,trigger:"blur",validator:(o,e,n)=>{e.trim().length>=2?n():n(new Error("职位名称至少两位"))}}]},F=async()=>{await V.value.validate(),(await de(i)).code==200&&(S({type:"success",message:i.id?"更新成功":"添加成功"}),f.value=!1,b(i.id?u.value:1))},H=async o=>{v.value=!0,Object.assign(i,o);let e=await ue(i.id);e.code==200&&(N.value=e.data,q.value=$(N.value,[]))},K={children:"children",label:"name"},$=(o,e)=>(o.forEach(n=>{n.select&&n.level==4&&e.push(n.id),n.children&&n.children.length>0&&$(n.children,e)}),e),G=async()=>{const o=i.id;let e=R.value.getCheckedKeys(),n=R.value.getHalfCheckedKeys(),w=e.concat(n);(await pe(o,w)).code==200&&(v.value=!1,S({type:"success",message:"分配权限成功"}),window.location.reload())},J=async o=>{(await me(o)).code==200&&(S({type:"success",message:"删除成功"}),b(z.value.length>1?u.value:u.value-1))};return(o,e)=>{const n=d("el-input"),w=d("el-form-item"),p=d("el-button"),A=d("el-form"),I=d("el-card"),k=d("el-table-column"),Q=d("el-popconfirm"),W=d("el-table"),X=d("el-pagination"),Y=d("el-dialog"),Z=d("el-tree"),h=d("el-drawer");return ae(),oe(ne,null,[l(I,null,{default:t(()=>[l(A,{inline:!0,class:"form"},{default:t(()=>[l(w,{label:"职位搜索"},{default:t(()=>[l(n,{placeholder:"请你输入搜索职位关键字",modelValue:r(g),"onUpdate:modelValue":e[0]||(e[0]=a=>_(g)?g.value=a:g=a)},null,8,["modelValue"])]),_:1}),l(w,null,{default:t(()=>[l(p,{type:"primary",size:"default",disabled:!r(g),onClick:T},{default:t(()=>e[8]||(e[8]=[c(" 搜索 ")])),_:1},8,["disabled"]),l(p,{type:"primary",size:"default",onClick:B},{default:t(()=>e[9]||(e[9]=[c("重置")])),_:1})]),_:1})]),_:1})]),_:1}),l(I,{style:{margin:"10px 0px"}},{default:t(()=>[l(p,{type:"primary",size:"default",icon:"Plus",onClick:D},{default:t(()=>e[10]||(e[10]=[c(" 添加职位 ")])),_:1}),l(W,{border:"",style:{margin:"10px 0px"},data:r(z)},{default:t(()=>[l(k,{type:"index",align:"center",label:"#"}),l(k,{label:"ID",align:"center",prop:"id"}),l(k,{label:"职位名称",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(k,{label:"创建世间",align:"center","show-overflow-tooltip":"",prop:"createTime"}),l(k,{label:"更新时间",align:"center","show-overflow-tooltip":"",prop:"updateTime"}),l(k,{label:"操作",width:"280px",align:"center"},{default:t(({row:a,$index:ge})=>[l(p,{type:"primary",size:"small",icon:"User",onClick:P=>H(a)},{default:t(()=>e[11]||(e[11]=[c(" 分配权限 ")])),_:2},1032,["onClick"]),l(p,{type:"primary",size:"small",icon:"Edit",onClick:P=>L(a)},{default:t(()=>e[12]||(e[12]=[c(" 编辑 ")])),_:2},1032,["onClick"]),l(Q,{title:`你确定要删除${a.roleName}?`,width:"260px",onConfirm:P=>J(a.id)},{reference:t(()=>[l(p,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>e[13]||(e[13]=[c(" 删除 ")])),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(X,{"current-page":r(u),"onUpdate:currentPage":e[1]||(e[1]=a=>_(u)?u.value=a:u=a),"page-size":r(x),"onUpdate:pageSize":e[2]||(e[2]=a=>_(x)?x.value=a:x=a),"page-sizes":[10,20,30,40],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:r(U),onCurrentChange:b,onSizeChange:j},null,8,["current-page","page-size","total"])]),_:1}),l(Y,{modelValue:r(f),"onUpdate:modelValue":e[5]||(e[5]=a=>_(f)?f.value=a:f=a),title:r(i).id?"更新职位":"添加职位"},{footer:t(()=>[l(p,{type:"primary",size:"default",onClick:e[4]||(e[4]=a=>_(f)?f.value=!1:f=!1)},{default:t(()=>e[14]||(e[14]=[c(" 取消 ")])),_:1}),l(p,{type:"primary",size:"default",onClick:F},{default:t(()=>e[15]||(e[15]=[c("确定")])),_:1})]),default:t(()=>[l(A,{model:r(i),rules:M,ref_key:"form",ref:V},{default:t(()=>[l(w,{label:"职位名称",prop:"roleName"},{default:t(()=>[l(n,{placeholder:"请你输入职位名称",modelValue:r(i).roleName,"onUpdate:modelValue":e[3]||(e[3]=a=>r(i).roleName=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(h,{modelValue:r(v),"onUpdate:modelValue":e[7]||(e[7]=a=>_(v)?v.value=a:v=a)},{header:t(()=>e[16]||(e[16]=[E("h4",null,"分配菜单与按钮的权限",-1)])),default:t(()=>[l(Z,{ref_key:"tree",ref:R,data:r(N),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":r(q),props:K},null,8,["data","default-checked-keys"])]),footer:t(()=>[E("div",fe,[l(p,{onClick:e[6]||(e[6]=a=>_(v)?v.value=!1:v=!1)},{default:t(()=>e[17]||(e[17]=[c("取消")])),_:1}),l(p,{type:"primary",onClick:G},{default:t(()=>e[18]||(e[18]=[c("确定")])),_:1})])]),_:1},8,["modelValue"])],64)}}});const be=re(ce,[["__scopeId","data-v-b3bcfffc"]]);export{be as default};
