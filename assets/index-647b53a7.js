import{u as me}from"./setting-7f6def1b.js";import{B as x,d as pe,r as i,c as fe,C as ve,e as p,o as S,f as $,g as l,w as t,h as r,z as k,k as m,i as q,t as B,p as F,m as ge,F as M,n as ce,v as H,D as z,_ as _e}from"./index-8f68718e.js";const ye=(u,d,_)=>x.get(`/admin/acl/user/${u}/${d}/?username=${_}`),be=u=>u.id?x.put("/admin/acl/user/update",u):x.post("/admin/acl/user/save",u),we=u=>x.get("/admin/acl/user/toAssign/"+u),Ve=u=>x.post("/admin/acl/user/doAssignRole",u),Ce=u=>x.delete("/admin/acl/user/remove/"+u),ke=u=>x.delete("/admin/acl/user/batchRemove",{data:u}),xe={style:{flex:"auto"}},Ue={style:{flex:"auto"}},ze=pe({__name:"index",setup(u){let d=i(1),_=i(5),L=i(0),R=i([]),v=i(!1),g=i(!1),U=i([]),y=i([]),n=fe({username:"",name:"",password:""}),A=i([]),b=i(),w=i(""),O=me();ve(()=>{V()});const V=async(o=1)=>{d.value=o;let e=await ye(d.value,_.value,w.value);e.code==200&&(L.value=e.data.total,R.value=e.data.records)},G=()=>{V()},J=()=>{v.value=!0,Object.assign(n,{id:0,username:"",name:"",password:""}),H(()=>{b.value.clearValidate("username"),b.value.clearValidate("name"),b.value.clearValidate("password")})},K=o=>{v.value=!0,Object.assign(n,o),H(()=>{b.value.clearValidate("username"),b.value.clearValidate("name")})},Q=async()=>{await b.value.validate(),(await be(n)).code==200?(v.value=!1,z({type:"success",message:n.id?"更新成功":"添加成功"}),window.location.reload()):(v.value=!1,z({type:"error",message:n.id?"更新失败":"添加失败"}))},W=()=>{v.value=!1},X={username:[{required:!0,trigger:"blur",validator:(o,e,s)=>{e.trim().length>=5?s():s(new Error("用户名字至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,e,s)=>{e.trim().length>=5?s():s(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,e,s)=>{e.trim().length>=6?s():s(new Error("用户密码至少六位"))}}]},Y=async o=>{Object.assign(n,o);let e=await we(n.id);e.code==200&&(U.value=e.data.allRolesList,y.value=e.data.assignRoles,g.value=!0)},I=i(!1),N=i(!0),Z=o=>{y.value=o?U.value:[],N.value=!1},ee=o=>{I.value=o.length===U.value.length,N.value=o.length!==U.value.length},le=async()=>{let o={userId:n.id,roleIdList:y.value.map(s=>s.id)};(await Ve(o)).code==200&&(z({type:"success",message:"分配职务成功"}),g.value=!1,V(d.value))},ae=async o=>{(await Ce(o)).code==200&&(z({type:"success",message:"删除成功"}),V(R.value.length>1?d.value:d.value-1))},te=o=>{A.value=o},oe=async()=>{let o=A.value.map(s=>s.id);(await ke(o)).code==200&&(z({type:"success",message:"删除成功"}),V(R.value.length>1?d.value:d.value-1))},re=()=>{V(),w.value=""},ne=()=>{O.refsh=!O.refsh};return(o,e)=>{const s=p("el-input"),C=p("el-form-item"),f=p("el-button"),E=p("el-form"),h=p("el-card"),c=p("el-table-column"),se=p("el-popconfirm"),ue=p("el-table"),de=p("el-pagination"),j=p("el-drawer"),D=p("el-checkbox"),ie=p("el-checkbox-group");return S(),$(M,null,[l(h,{style:{height:"80px"}},{default:t(()=>[l(E,{inline:!0,class:"form"},{default:t(()=>[l(C,{label:"用户名:"},{default:t(()=>[l(s,{placeholder:"请你输入搜索用户名",modelValue:r(w),"onUpdate:modelValue":e[0]||(e[0]=a=>k(w)?w.value=a:w=a)},null,8,["modelValue"])]),_:1}),l(C,null,{default:t(()=>[l(f,{type:"primary",size:"default",disabled:!r(w),onClick:re},{default:t(()=>e[12]||(e[12]=[m("搜索")])),_:1},8,["disabled"]),l(f,{type:"primary",size:"default",onClick:ne},{default:t(()=>e[13]||(e[13]=[m("重置")])),_:1})]),_:1})]),_:1})]),_:1}),l(h,{style:{margin:"10px 0px"}},{default:t(()=>[l(f,{type:"primary",size:"default",onClick:J},{default:t(()=>e[14]||(e[14]=[m("添加用户")])),_:1}),l(f,{type:"primary",size:"default",disabled:!r(A).length,onClick:oe},{default:t(()=>e[15]||(e[15]=[m("批量删除")])),_:1},8,["disabled"]),l(ue,{onSelectionChange:te,style:{margin:"10px 0px"},border:"",data:r(R)},{default:t(()=>[l(c,{type:"selection",align:"center"}),l(c,{label:"#",align:"center",type:"index"}),l(c,{label:"ID",align:"center",prop:"id"}),l(c,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":""}),l(c,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":""}),l(c,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(c,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(c,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(c,{label:"操作",width:"300px",align:"center"},{default:t(({row:a,$index:P})=>[l(f,{type:"primary",size:"small",icon:"User",onClick:T=>Y(a)},{default:t(()=>e[16]||(e[16]=[m("分配角色")])),_:2},1032,["onClick"]),l(f,{type:"primary",size:"small",icon:"Edit",onClick:T=>K(a)},{default:t(()=>e[17]||(e[17]=[m("编辑")])),_:2},1032,["onClick"]),l(se,{title:`你确定要删除${a.username}?`,width:"260px",onConfirm:T=>ae(a.id)},{reference:t(()=>[l(f,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>e[18]||(e[18]=[m("删除")])),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(de,{"current-page":r(d),"onUpdate:currentPage":e[1]||(e[1]=a=>k(d)?d.value=a:d=a),"page-size":r(_),"onUpdate:pageSize":e[2]||(e[2]=a=>k(_)?_.value=a:_=a),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:r(L),onCurrentChange:V,onSizeChange:G},null,8,["current-page","page-size","total"])]),_:1}),l(j,{modelValue:r(v),"onUpdate:modelValue":e[6]||(e[6]=a=>k(v)?v.value=a:v=a)},{header:t(()=>[q("h4",null,B(r(n).id?"更新用户":"添加用户"),1)]),default:t(()=>[l(E,{model:r(n),rules:X,ref_key:"formRef",ref:b},{default:t(()=>[l(C,{label:"用户姓名",prop:"username"},{default:t(()=>[l(s,{placeholder:"请您输入用户姓名",modelValue:r(n).username,"onUpdate:modelValue":e[3]||(e[3]=a=>r(n).username=a)},null,8,["modelValue"])]),_:1}),l(C,{label:"用户昵称",prop:"name"},{default:t(()=>[l(s,{placeholder:"请您输入用户昵称",modelValue:r(n).name,"onUpdate:modelValue":e[4]||(e[4]=a=>r(n).name=a)},null,8,["modelValue"])]),_:1}),r(n).id?ge("",!0):(S(),F(C,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(s,{placeholder:"请您输入用户密码",modelValue:r(n).password,"onUpdate:modelValue":e[5]||(e[5]=a=>r(n).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:t(()=>[q("div",xe,[l(f,{onClick:W},{default:t(()=>e[19]||(e[19]=[m("取消")])),_:1}),l(f,{type:"primary",onClick:Q},{default:t(()=>e[20]||(e[20]=[m("确定")])),_:1})])]),_:1},8,["modelValue"]),l(j,{modelValue:r(g),"onUpdate:modelValue":e[11]||(e[11]=a=>k(g)?g.value=a:g=a)},{header:t(()=>e[21]||(e[21]=[q("h4",null,"分配角色(职位)",-1)])),default:t(()=>[l(E,null,{default:t(()=>[l(C,{label:"用户姓名"},{default:t(()=>[l(s,{modelValue:r(n).username,"onUpdate:modelValue":e[7]||(e[7]=a=>r(n).username=a),disabled:!0},null,8,["modelValue"])]),_:1}),l(C,{label:"职位列表"},{default:t(()=>[l(D,{onChange:Z,modelValue:I.value,"onUpdate:modelValue":e[8]||(e[8]=a=>I.value=a),indeterminate:N.value},{default:t(()=>e[22]||(e[22]=[m("全选")])),_:1},8,["modelValue","indeterminate"]),l(ie,{modelValue:r(y),"onUpdate:modelValue":e[9]||(e[9]=a=>k(y)?y.value=a:y=a),onChange:ee},{default:t(()=>[(S(!0),$(M,null,ce(r(U),(a,P)=>(S(),F(D,{key:P,label:a},{default:t(()=>[m(B(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:t(()=>[q("div",Ue,[l(f,{onClick:e[10]||(e[10]=a=>k(g)?g.value=!1:g=!1)},{default:t(()=>e[23]||(e[23]=[m("取消")])),_:1}),l(f,{type:"primary",onClick:le},{default:t(()=>e[24]||(e[24]=[m("确定")])),_:1})])]),_:1},8,["modelValue"])],64)}}});const Ne=_e(ze,[["__scopeId","data-v-b5ebae91"]]);export{Ne as default};
