import{B as $,d as ee,r as c,N as ie,e as o,o as g,p as w,w as t,g as e,h as a,f as B,n as M,F as R,z as G,i as W,k as E,D as P,t as pe,c as me,M as ce,I as fe,s as _e,J as ge,x as Y,y as Z}from"./index-8f68718e.js";const Se=(S,b,V)=>$.get(`/admin/product/${S}/${b}?category3Id=${V}`),le=()=>$.get("/admin/product/baseTrademark/getTrademarkList"),ae=S=>$.get("/admin/product/spuImageList/"+S),ue=S=>$.get("/admin/product/spuSaleAttrList/"+S),te=()=>$.get("/admin/product/baseSaleAttrList"),ye=S=>S.id?$.post("/admin/product/updateSpuInfo",S):$.post("/admin/product/saveSpuInfo",S),ve=S=>$.post("/admin/product/saveSkuInfo",S),be=S=>$.get("/admin/product/findBySpuId/"+S),Ve=S=>$.delete("/admin/product/deleteSpu/"+S),ke=["src"],Ie=ee({__name:"spuForm",emits:["changeScene"],setup(S,{expose:b,emit:V}){let v=V;const C=()=>{v("changeScene",{flag:0,params:"update"})};let x=c([]),k=c([]),r=c([]),D=c([]),N=c(!1),h=c(""),i=c({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),U=c("");const L=async l=>{i.value=l;let u=await le(),s=await ae(l.id),A=await ue(l.id),H=await te();x.value=u.data,k.value=s.data.map(z=>({name:z.imgName,url:z.imgUrl})),r.value=A.data,D.value=H.data},d=l=>{h.value=l.url,N.value=!0},m=()=>{console.log(123)},f=l=>l.type=="image/png"||l.type=="image/jpeg"||l.type=="image/gif"?l.size/1024/1024<3?!0:(P({type:"error",message:"上传文件务必小于3M"}),!1):(P({type:"error",message:"上传文件务必PNG|JPG|GIF"}),!1);let I=ie(()=>D.value.filter(u=>r.value.every(s=>u.name!=s.saleAttrName)));const K=()=>{const[l,u]=U.value.split(":");let s={baseSaleAttrId:l,saleAttrName:u,spuSaleAttrValueList:[]};r.value.push(s),U.value=""},_=l=>{l.flag=!0,l.saleAttrValue=""},p=l=>{const{baseSaleAttrId:u,saleAttrValue:s}=l;let A={baseSaleAttrId:u,saleAttrValueName:s};if(s.trim()==""){P({type:"error",message:"属性值不能为空的"});return}if(l.spuSaleAttrValueList.find(z=>z.saleAttrValueName==s)){P({type:"error",message:"属性值重复"});return}l.spuSaleAttrValueList.push(A),l.flag=!1},F=async()=>{i.value.spuImageList=k.value.map(u=>({imgName:u.name,imgUrl:u.response&&u.response.data||u.url})),i.value.spuSaleAttrList=r.value,(await ye(i.value)).code==200?(P({type:"success",message:i.value.id?"更新成功":"添加成功"}),v("changeScene",{flag:0,params:i.value.id?"update":"add"})):P({type:"success",message:i.value.id?"更新成功":"添加成功"})};return b({initHasSpuData:L,initAddSpu:async l=>{Object.assign(i.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),k.value=[],r.value=[],U.value="",i.value.category3Id=l;let u=await le(),s=await te();x.value=u.data,D.value=s.data}}),(l,u)=>{const s=o("el-input"),A=o("el-form-item"),H=o("el-option"),z=o("el-select"),y=o("Plus"),X=o("el-icon"),j=o("el-upload"),ne=o("el-dialog"),J=o("el-button"),O=o("el-table-column"),se=o("el-tag"),oe=o("el-table"),re=o("el-form");return g(),w(re,{"label-width":"100px"},{default:t(()=>[e(A,{label:"SPU名称"},{default:t(()=>[e(s,{placeholder:"请你输入SPU名称",modelValue:a(i).spuName,"onUpdate:modelValue":u[0]||(u[0]=n=>a(i).spuName=n)},null,8,["modelValue"])]),_:1}),e(A,{label:"SPU品牌"},{default:t(()=>[e(z,{modelValue:a(i).tmId,"onUpdate:modelValue":u[1]||(u[1]=n=>a(i).tmId=n)},{default:t(()=>[(g(!0),B(R,null,M(a(x),(n,Q)=>(g(),w(H,{key:n.id,label:n.tmName,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(A,{label:"SPU描述"},{default:t(()=>[e(s,{type:"textarea",placeholder:"请你输入SPU描述",modelValue:a(i).description,"onUpdate:modelValue":u[2]||(u[2]=n=>a(i).description=n)},null,8,["modelValue"])]),_:1}),e(A,{label:"SPU图片"},{default:t(()=>[e(j,{"file-list":a(k),"onUpdate:fileList":u[3]||(u[3]=n=>G(k)?k.value=n:k=n),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":d,"on-remove":m,"before-upload":f},{default:t(()=>[e(X,null,{default:t(()=>[e(y)]),_:1})]),_:1},8,["file-list"]),e(ne,{modelValue:a(N),"onUpdate:modelValue":u[4]||(u[4]=n=>G(N)?N.value=n:N=n)},{default:t(()=>[W("img",{"w-full":"",src:a(h),alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,ke)]),_:1},8,["modelValue"])]),_:1}),e(A,{label:"SPU销售属性"},{default:t(()=>[e(z,{modelValue:a(U),"onUpdate:modelValue":u[5]||(u[5]=n=>G(U)?U.value=n:U=n),placeholder:a(I).length?`还未选择${a(I).length}个`:"无"},{default:t(()=>[(g(!0),B(R,null,M(a(I),(n,Q)=>(g(),w(H,{value:`${n.id}:${n.name}`,key:n.id,label:n.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"]),e(J,{onClick:K,disabled:!a(U),style:{"margin-left":"10px"},type:"primary",size:"default",icon:"Plus"},{default:t(()=>u[6]||(u[6]=[E("添加属性")])),_:1},8,["disabled"]),e(oe,{border:"",style:{margin:"10px 0px"},data:a(r)},{default:t(()=>[e(O,{label:"序号",type:"index",align:"center",width:"80px"}),e(O,{label:"销售属性名字",width:"120px",prop:"saleAttrName"}),e(O,{label:"销售属性值"},{default:t(({row:n,$index:Q})=>[(g(!0),B(R,null,M(n.spuSaleAttrValueList,(T,de)=>(g(),w(se,{style:{margin:"0px 5px"},onClose:Ce=>n.spuSaleAttrValueList.splice(de,1),key:n.id,class:"mx-1",closable:""},{default:t(()=>[E(pe(T.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),n.flag==!0?(g(),w(s,{key:0,onBlur:T=>p(n),modelValue:n.saleAttrValue,"onUpdate:modelValue":T=>n.saleAttrValue=T,placeholder:"请你输入属性值",size:"small",style:{width:"100px"}},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(g(),w(J,{key:1,onClick:T=>_(n),type:"primary",size:"small",icon:"Plus"},null,8,["onClick"]))]),_:1}),e(O,{label:"操作",width:"120px"},{default:t(({row:n,$index:Q})=>[e(J,{type:"primary",size:"small",icon:"Delete",onClick:T=>a(r).splice(Q,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(A,null,{default:t(()=>[e(J,{disabled:!(a(r).length>0),type:"primary",size:"default",onClick:F},{default:t(()=>u[7]||(u[7]=[E("保存")])),_:1},8,["disabled"]),e(J,{type:"primary",size:"default",onClick:C},{default:t(()=>u[8]||(u[8]=[E("取消")])),_:1})]),_:1})]),_:1})}}}),Ae=["src"],Ue=ee({__name:"skuForm",emits:["changeScene"],setup(S,{expose:b,emit:V}){let v=c([]),C=c([]),x=c([]),k=c(),r=me({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""});const D=async(L,d,m)=>{r.category3Id=m.category3Id,r.spuId=m.id,r.tmId=m.tmId;let f=await ce(L,d,m.category3Id),I=await ue(m.id),K=await ae(m.id);v.value=f.data,C.value=I.data,x.value=K.data},N=()=>{U("changeScene",{flag:0,params:""})},h=L=>{x.value.forEach(d=>{k.value.toggleRowSelection(d,!1)}),k.value.toggleRowSelection(L,!0),r.skuDefaultImg=L.imgUrl};b({initSkuData:D});const i=async()=>{r.skuAttrValueList=v.value.reduce((d,m)=>{if(m.attrIdAndValueId){let[f,I]=m.attrIdAndValueId.split(":");d.push({attrId:f,valueId:I})}return d},[]),r.skuSaleAttrValueList=C.value.reduce((d,m)=>{if(m.saleIdAndValueId){let[f,I]=m.saleIdAndValueId.split(":");d.push({saleAttrId:f,saleAttrValueId:I})}return d},[]),(await ve(r)).code==200?(P({type:"success",message:"添加SKU成功"}),U("changeScene",{flag:0,params:""})):P({type:"error",message:"添加SKU失败"})};let U=V;return(L,d)=>{const m=o("el-input"),f=o("el-form-item"),I=o("el-option"),K=o("el-select"),_=o("el-form"),p=o("el-table-column"),F=o("el-button"),q=o("el-table");return g(),w(_,{"label-width":"100px"},{default:t(()=>[e(f,{label:"SKU名称"},{default:t(()=>[e(m,{placeholder:"SKU名称",modelValue:a(r).skuName,"onUpdate:modelValue":d[0]||(d[0]=l=>a(r).skuName=l)},null,8,["modelValue"])]),_:1}),e(f,{label:"价格(元)"},{default:t(()=>[e(m,{placeholder:"价格(元)",type:"number",modelValue:a(r).price,"onUpdate:modelValue":d[1]||(d[1]=l=>a(r).price=l)},null,8,["modelValue"])]),_:1}),e(f,{label:"重量(g)"},{default:t(()=>[e(m,{placeholder:"重量(g)",type:"number",modelValue:a(r).weight,"onUpdate:modelValue":d[2]||(d[2]=l=>a(r).weight=l)},null,8,["modelValue"])]),_:1}),e(f,{label:"SKU描述"},{default:t(()=>[e(m,{placeholder:"SKU描述",type:"textarea",modelValue:a(r).skuDesc,"onUpdate:modelValue":d[3]||(d[3]=l=>a(r).skuDesc=l)},null,8,["modelValue"])]),_:1}),e(f,{label:"平台属性"},{default:t(()=>[e(_,{inline:!0},{default:t(()=>[(g(!0),B(R,null,M(a(v),(l,u)=>(g(),w(f,{key:l.id,label:l.attrName},{default:t(()=>[e(K,{modelValue:l.attrIdAndValueId,"onUpdate:modelValue":s=>l.attrIdAndValueId=s},{default:t(()=>[(g(!0),B(R,null,M(l.attrValueList,(s,A)=>(g(),w(I,{value:`${l.id}:${s.id}`,key:s.id,label:s.valueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(f,{label:"销售属性"},{default:t(()=>[e(_,{inline:!0},{default:t(()=>[(g(!0),B(R,null,M(a(C),(l,u)=>(g(),w(f,{label:l.saleAttrName,key:l.id},{default:t(()=>[e(K,{modelValue:l.saleIdAndValueId,"onUpdate:modelValue":s=>l.saleIdAndValueId=s},{default:t(()=>[(g(!0),B(R,null,M(l.spuSaleAttrValueList,(s,A)=>(g(),w(I,{value:`${l.id}:${s.id}`,key:s.id,label:s.saleAttrValueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(f,{label:"图片名称"},{default:t(()=>[e(q,{border:"",data:a(x),ref_key:"table",ref:k},{default:t(()=>[e(p,{type:"selection",width:"80px",align:"center"}),e(p,{label:"图片"},{default:t(({row:l,$index:u})=>[W("img",{src:l.imgUrl,alt:"",style:{width:"100px",height:"100px"}},null,8,Ae)]),_:1}),e(p,{label:"名称",prop:"imgName"}),e(p,{label:"操作"},{default:t(({row:l,$index:u})=>[e(F,{type:"primary",size:"small",onClick:s=>h(l)},{default:t(()=>d[4]||(d[4]=[E(" 设置默认 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(f,null,{default:t(()=>[e(F,{type:"primary",size:"default",onClick:i},{default:t(()=>d[5]||(d[5]=[E("保存")])),_:1}),e(F,{type:"primary",size:"default",onClick:N},{default:t(()=>d[6]||(d[6]=[E("取消")])),_:1})]),_:1})]),_:1})}}}),xe=["src"],Ne=ee({__name:"index",setup(S){let b=fe(),V=c(0),v=c(1),C=c(3),x=c([]),k=c(0),r=c(),D=c(),N=c([]),h=c(!1);_e(()=>b.c3Id,()=>{x.value=[],b.c3Id&&i()});const i=async(_=1)=>{v.value=_;let p=await Se(v.value,C.value,b.c3Id);p.code==200&&(x.value=p.data.records,k.value=p.data.total)},U=()=>{i()},L=()=>{V.value=1,r.value.initAddSpu(b.c3Id)},d=_=>{V.value=1,r.value.initHasSpuData(_)},m=_=>{V.value=_.flag,_.params=="update"?i(v.value):i()},f=_=>{V.value=2,D.value.initSkuData(b.c1Id,b.c2Id,_)},I=async _=>{let p=await be(_.id);p.code==200&&(N.value=p.data,h.value=!0)},K=async _=>{(await Ve(_.id)).code==200?(P({type:"success",message:"删除成功"}),i(x.value.length>1?v.value:v.value-1)):P({type:"error",message:"删除失败"})};return ge(()=>{b.$reset()}),(_,p)=>{const F=o("Category"),q=o("el-button"),l=o("el-table-column"),u=o("el-popconfirm"),s=o("el-table"),A=o("el-pagination"),H=o("el-dialog"),z=o("el-card");return g(),B("div",null,[e(F,{scene:a(V)},null,8,["scene"]),e(z,{style:{margin:"10px 0px"}},{default:t(()=>[Y(W("div",null,[e(q,{onClick:L,type:"primary",size:"default",icon:"Plus",disabled:!a(b).c3Id},{default:t(()=>p[3]||(p[3]=[E(" 添加SPU ")])),_:1},8,["disabled"]),e(s,{style:{margin:"10px 0px"},border:"",data:a(x)},{default:t(()=>[e(l,{label:"序号",type:"index",align:"center",width:"80px"}),e(l,{label:"SPU名称",prop:"spuName"}),e(l,{label:"SPU描述",prop:"description","show-overflow-tooltip":""}),e(l,{label:"SPU操作"},{default:t(({row:y,$index:X})=>[e(q,{type:"primary",size:"small",icon:"Plus",title:"添加SKU",onClick:j=>f(y)},null,8,["onClick"]),e(q,{type:"primary",size:"small",icon:"Edit",title:"修改SPU",onClick:j=>d(y)},null,8,["onClick"]),e(q,{type:"primary",size:"small",icon:"View",title:"查看SKU列表",onClick:j=>I(y)},null,8,["onClick"]),e(u,{title:`你确定删除${y.spuName}?`,width:"200px",onConfirm:j=>K(y)},{reference:t(()=>[e(q,{type:"primary",size:"small",icon:"Delete",title:"删除SPU"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(A,{"current-page":a(v),"onUpdate:currentPage":p[0]||(p[0]=y=>G(v)?v.value=y:v=y),"page-size":a(C),"onUpdate:pageSize":p[1]||(p[1]=y=>G(C)?C.value=y:C=y),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:a(k),onCurrentChange:i,onSizeChange:U},null,8,["current-page","page-size","total"])],512),[[Z,a(V)==0]]),Y(e(Ie,{ref_key:"spu",ref:r,onChangeScene:m},null,512),[[Z,a(V)==1]]),Y(e(Ue,{ref_key:"sku",ref:D,onChangeScene:m},null,512),[[Z,a(V)==2]]),e(H,{modelValue:a(h),"onUpdate:modelValue":p[2]||(p[2]=y=>G(h)?h.value=y:h=y),title:"SKU列表"},{default:t(()=>[e(s,{border:"",data:a(N)},{default:t(()=>[e(l,{label:"SKU名字",prop:"skuName"}),e(l,{label:"SKU价格",prop:"price"}),e(l,{label:"SKU重量",prop:"weight"}),e(l,{label:"SKU图片"},{default:t(({row:y,$index:X})=>[W("img",{src:y.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,xe)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}});export{Ne as default};
