import{d as T,I as K,r as x,c as R,s as G,J as H,e as u,o as _,f as k,g as e,h as o,w as l,x as A,y as I,i as z,k as f,F as Q,n as W,p as B,t as S,v as $,K as X,D as y,L as Y,M as Z}from"./index-8f68718e.js";const ee=["onClick"],se=T({__name:"index",setup(te){let m=K(),v=x([]),d=x(0),a=R({attrName:"",attrValueList:[],categoryId:"",categoryLevel:3}),b=x([]);G(()=>m.c3Id,()=>{v.value=[],m.c3Id&&V()});const V=async()=>{const{c1Id:r,c2Id:t,c3Id:g}=m;let n=await Z(r,t,g);n.code==200&&(v.value=n.data)},h=()=>{Object.assign(a,{attrName:"",attrValueList:[],categoryId:m.c3Id,categoryLevel:3}),d.value=1},D=r=>{d.value=1,Object.assign(a,JSON.parse(JSON.stringify(r)))},N=()=>{d.value=0},O=()=>{a.attrValueList.push({valueName:"",flag:!0}),$(()=>{b.value[a.attrValueList.length-1].focus()})},U=async()=>{(await X(a)).code==200?(d.value=0,y({type:"success",message:a.id?"修改成功":"添加成功"}),V()):y({type:"error",message:a.id?"修改失败":"添加失败"})},w=(r,t)=>{if(r.valueName.trim()==""){a.attrValueList.splice(t,1),y({type:"error",message:"属性值不能为空"});return}if(a.attrValueList.find(n=>{if(n!=r)return n.valueName===r.valueName})){a.attrValueList.splice(t,1),y({type:"error",message:"属性值不能重复"});return}r.flag=!1},E=(r,t)=>{r.flag=!0,$(()=>{b.value[t].focus()})},q=async r=>{(await Y(r)).code==200?(y({type:"success",message:"删除成功"}),V()):y({type:"error",message:"删除失败"})};return H(()=>{m.$reset()}),(r,t)=>{const g=u("Category"),n=u("el-button"),c=u("el-table-column"),J=u("el-tag"),P=u("el-popconfirm"),C=u("el-table"),L=u("el-input"),j=u("el-form-item"),F=u("el-form"),M=u("el-card");return _(),k("div",null,[e(g,{scene:o(d)},null,8,["scene"]),e(M,{style:{margin:"10px 0px"}},{default:l(()=>[A(z("div",null,[e(n,{onClick:h,type:"primary",size:"default",icon:"Plus",disabled:!o(m).c3Id},{default:l(()=>t[1]||(t[1]=[f("添加属性")])),_:1},8,["disabled"]),e(C,{border:"",style:{margin:"10px 0px"},data:o(v)},{default:l(()=>[e(c,{label:"序号",type:"index",align:"center",width:"80px"}),e(c,{label:"属性名称",width:"120px",prop:"attrName"}),e(c,{label:"属性值名称"},{default:l(({row:s,$index:p})=>[(_(!0),k(Q,null,W(s.attrValueList,(i,ae)=>(_(),B(J,{style:{margin:"5px"},key:i.id},{default:l(()=>[f(S(i.valueName),1)]),_:2},1024))),128))]),_:1}),e(c,{label:"操作",width:"120px"},{default:l(({row:s,$index:p})=>[e(n,{type:"primary",size:"small",icon:"Edit",onClick:i=>D(s)},null,8,["onClick"]),e(P,{title:`你确定删除${s.attrName}?`,width:"200px",onConfirm:i=>q(s.id)},{reference:l(()=>[e(n,{type:"primary",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[I,o(d)==0]]),A(z("div",null,[e(F,{inline:!0},{default:l(()=>[e(j,{label:"属性名称"},{default:l(()=>[e(L,{placeholder:"请你输入属性名称",modelValue:o(a).attrName,"onUpdate:modelValue":t[0]||(t[0]=s=>o(a).attrName=s)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{onClick:O,disabled:!o(a).attrName,type:"primary",size:"default",icon:"Plus"},{default:l(()=>t[2]||(t[2]=[f("添加属性值")])),_:1},8,["disabled"]),e(n,{type:"primary",size:"default",onClick:N},{default:l(()=>t[3]||(t[3]=[f("取消")])),_:1}),e(C,{border:"",style:{margin:"10px 0px"},data:o(a).attrValueList},{default:l(()=>[e(c,{label:"序号",width:"80px",type:"index",align:"center"}),e(c,{label:"属性值名称"},{default:l(({row:s,$index:p})=>[s.flag?(_(),B(L,{key:0,ref:i=>o(b)[p]=i,onBlur:i=>w(s,p),size:"small",placeholder:"请你输入属性值名称",modelValue:s.valueName,"onUpdate:modelValue":i=>s.valueName=i},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(_(),k("div",{key:1,onClick:i=>E(s,p)},S(s.valueName),9,ee))]),_:1}),e(c,{label:"属性值操作"},{default:l(({row:s,index:p})=>[e(n,{type:"primary",size:"small",icon:"Delete",onClick:i=>o(a).attrValueList.splice(p,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(n,{type:"primary",size:"default",onClick:U,disabled:!(o(a).attrValueList.length>0)},{default:l(()=>t[4]||(t[4]=[f("保存")])),_:1},8,["disabled"]),e(n,{type:"primary",size:"default",onClick:N},{default:l(()=>t[5]||(t[5]=[f("取消")])),_:1})],512),[[I,o(d)==1]])]),_:1})])}}});export{se as default};
